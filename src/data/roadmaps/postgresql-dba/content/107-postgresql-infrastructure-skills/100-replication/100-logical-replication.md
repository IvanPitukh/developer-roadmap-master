# Logical Replication

Logical replication is a method of replicating data and database objects like tables or even specific table rows, so that the changes made in one database are reflected in another one. It provides more flexibility and granularity than physical replication, which replicates the entire database cluster.

## Advantages of Logical Replication

- **Selective replication**: You can choose specific tables or even rows within tables to replicate.
- **Different schema versions**: With logical replication, it is possible to have slightly different schemas between the source and target database, allowing you to maintain different versions of your application with minimal downtime and data inconsistency.
- **Cross-version compatibility**: Logical replication can work across different major versions of PostgreSQL, enabling smoother upgrading processes.

## Components of Logical Replication

- **Publication**: It is a set of changes generated by a publisher in one database, which can be sent to one or more subscribers. You can create a publication on a specific table, multiple tables, or even on all tables within a database.

- **Subscription**: It represents the receiving end of a publication, i.e., the database that receives and applies the changes from a publisher. A subscription can be associated with one or more publications.

## Setting Up Logical Replication

To set up logical replication, follow these steps:

- Enable logical replication by adding `wal_level = logical` and `max_replication_slots = <number_of_slots>` in the `postgresql.conf` file and restart the PostgreSQL instance.

- Create a user for replication with the `REPLICATION` privilege:

   ```
   CREATE USER replicator WITH REPLICATION PASSWORD 'password';
   ```

- Grant access to the replication user by adding the following line to the `pg_hba.conf` file and reload the configuration:

   ```
   host replication replicator <ip_address> md5
   ```

- On the publisher side, create a publication by specifying the tables you want to publish:

   ```sql
   CREATE PUBLICATION my_publication FOR TABLE table1, table2;
   ```

- On the subscriber side, create a subscription by specifying the connection information and the publication to subscribe to:

   ```sql
   CREATE SUBSCRIPTION my_subscription CONNECTION 'host=ip_address dbname=db_name user=replicator password=password' PUBLICATION my_publication;
   ```

After setting up the subscription, the data from the publisher will automatically synchronize to the subscriber.

Remember that logical replication might require additional maintenance and monitoring efforts, since it doesn't synchronize indexes, constraints, or stored procedures. You need to create those objects manually on the subscriber side if needed.

Now that you have an understanding of logical replication, you can use it to improve the performance, flexibility, and fault tolerance of your PostgreSQL databases.